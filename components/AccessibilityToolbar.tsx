'use client'

import React, { useState, useEffect } from 'react'
import { Volume2, Eye, Minus, Plus, X } from 'lucide-react'
import { useAccessibility } from '@/contexts/AccessibilityContext'
import { Button } from '@/components/ui/button'
import { Slider } from '@/components/ui/slider'
import { Switch } from '@/components/ui/switch'
import { Label } from '@/components/ui/label'
import Image from 'next/image'

export function AccessibilityToolbar() {
  const [isOpen, setIsOpen] = useState(false)
  const [isMounted, setIsMounted] = useState(false)

  useEffect(() => {
    setIsMounted(true)
  }, [])
  const {
    fontSize,
    highContrast,
    reducedMotion,
    ttsEnabled,
    setFontSize,
    setHighContrast,
    setReducedMotion,
    setTtsEnabled,
  } = useAccessibility()

  if (!isMounted) {
    return (
      <div className="fixed bottom-8 right-8 z-50">
        <button
          className="h-16 w-16 rounded-full bg-blue-600 shadow-2xl flex items-center justify-center p-2"
          aria-label="Open accessibility settings"
          disabled
        >
          <div className="relative w-full h-full flex items-center justify-center">
            <svg width="40" height="35" viewBox="0 0 100 87" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clipPath="url(#clip0_11_11)">
                <path d="M82.8175 33.191L76.9477 47.0651C78.0149 48.0256 78.9755 48.8794 79.7225 49.6265L86.1259 34.5784L86.4461 33.7247V33.6179C87.0865 31.6969 87.4066 29.7759 87.4066 27.7481C87.4066 18.2497 79.7225 10.5656 70.2241 10.5656C60.7257 10.5656 53.0416 18.2497 53.0416 27.7481V30.9498H54.8559H56.5635L56.6702 27.3212C56.8837 19.9573 62.9669 14.0875 70.3309 14.0875C77.8015 14.0875 83.9915 20.1708 83.9915 27.7481C83.9915 29.349 83.778 30.8431 83.2444 32.3372L82.8175 33.191Z" fill="#FFFFFF"/>
                <path d="M70.1174 2.2412C56.0299 2.2412 44.5037 13.7673 44.5037 27.8549H48.1323C48.1323 15.6884 58.0576 5.8698 70.1174 5.8698C82.1772 5.8698 92.1025 15.7951 92.1025 27.8549C92.1025 30.5229 91.6756 33.0843 90.7151 35.539L90.6083 35.8591L74.3863 73.6393L73.8527 74.7065C71.3981 78.9755 66.809 81.5368 61.8997 81.5368C57.4173 81.5368 53.3618 79.2956 50.8004 75.9872C49.6265 76.4141 48.4525 76.7343 47.1718 77.0544C50.2668 81.9637 55.7097 85.1654 61.8997 85.1654C68.0897 85.1654 73.8527 81.857 76.9477 76.5208L77.6948 75.1334L94.0235 37.2465L94.2369 36.8196C95.3042 33.9381 95.8378 30.9498 95.8378 27.8549C95.7311 13.7673 84.2049 2.2412 70.1174 2.2412Z" fill="#FFFFFF"/>
                <path d="M46.7449 73.6393C48.9861 73.2124 51.2273 72.6788 53.4685 71.9317L59.2316 66.1686L73.6393 51.7609C74.4931 52.508 75.2401 53.1483 75.7738 53.682L70.5443 58.9114L60.5123 68.9434C63.0736 67.6627 65.635 66.1686 68.0896 64.5678C71.5048 62.3266 74.1729 60.0854 76.0939 58.2711C76.4141 58.0576 76.6275 57.8442 76.841 57.6307C78.4418 56.1366 79.2956 55.1761 79.4024 55.0694L79.8292 54.5358L80.3629 54.0021L79.4024 52.9349C79.2956 52.8282 78.8687 52.2946 77.9082 51.4408C77.8015 51.334 77.8015 51.334 77.6948 51.2273C77.1612 50.6937 76.5208 50.1601 75.7738 49.413C75.3469 49.0928 74.92 48.666 74.3863 48.2391C73.9594 47.9189 73.5326 47.492 72.9989 47.1718C72.4653 46.7449 71.825 46.2113 71.1846 45.7844C71.0779 45.6777 70.9712 45.571 70.7577 45.4642C69.7972 44.8239 68.8367 44.0768 67.8762 43.4365C67.1291 42.9029 66.2754 42.3693 65.5283 41.9424C64.4611 41.302 63.3938 40.6617 62.3266 40.1281C61.5795 39.7012 60.7257 39.2743 59.9787 38.9541L75.0267 23.9061L71.0779 20.7044L54.8559 36.8196C49.8399 35.0053 44.9306 34.0448 40.1281 34.0448C35.1121 34.0448 29.9893 35.0053 24.7599 37.0331C20.5977 38.6339 16.4354 40.7684 12.3799 43.5432C5.4429 48.2391 1.17396 52.8282 0.960512 53.0416L0 54.1089L0.960512 55.1761C1.17396 55.3895 5.4429 59.9787 12.3799 64.6745C13.3404 65.3148 14.4077 65.9552 15.3682 66.5955C17.5027 67.8762 19.5304 68.9434 21.6649 69.9039L4.90929 86.873H12.2732L27.1078 72.0384L30.8431 68.3031L33.7247 65.4216L35.9658 63.1804L49.0929 50.0534L51.334 47.8122L54.2156 44.9306L56.4568 42.6894L57.6307 41.5155C58.3778 41.8356 59.2316 42.2625 59.9787 42.6894L57.7375 44.9306L55.3895 47.2785L33.0843 69.5838L29.7759 72.8922C31.1633 73.2124 32.5507 73.5325 33.9381 73.746L36.8196 70.8645L56.7769 50.9072L59.3383 48.3458L63.2871 44.397C64.0342 44.8239 64.8879 45.3575 65.635 45.8911L60.0854 51.4408L57.2038 54.3223L40.4482 71.0779L37.46 74.0662C37.8869 74.0662 38.4205 74.1729 38.8474 74.1729C39.2743 74.1729 39.8079 74.1729 40.2348 74.1729C40.9819 74.1729 41.7289 74.1729 42.3693 74.0662L46.6382 69.7972L55.8164 60.619L60.0854 56.3501L68.5165 47.9189C69.1569 48.3458 69.6905 48.7727 70.2241 49.1996C70.4376 49.3063 70.5443 49.413 70.651 49.6265L58.9114 61.4728L46.7449 73.6393ZM39.8079 37.1398C39.9146 37.1398 40.1281 37.1398 40.2348 37.1398C40.3415 37.1398 40.555 37.1398 40.6617 37.1398C44.5037 37.2465 48.0256 38.6339 50.8004 40.8751L47.9189 43.7567C45.7844 42.1558 43.0096 41.1953 40.1281 41.1953C32.9776 41.1953 27.1078 47.0651 27.1078 54.2156C27.1078 54.429 27.1078 54.7492 27.1078 54.9626C27.2145 57.6307 28.175 59.9787 29.6692 62.0064L26.7876 64.8879C25.2935 63.0736 24.2263 60.8324 23.5859 58.4845C23.2657 57.0971 23.0523 55.7097 23.0523 54.2156C23.2657 44.9306 30.6297 37.3533 39.8079 37.1398ZM17.8228 64.3543C16.6489 63.714 15.4749 62.9669 14.301 62.2199C9.60512 59.0181 6.08324 55.8164 4.37567 54.2156C5.97652 52.6147 9.4984 49.413 14.1942 46.2113C18.0363 43.5432 21.9851 41.5155 25.9338 40.0213C22.3052 43.6499 20.064 48.666 20.064 54.2156C20.064 56.5635 20.4909 58.8047 21.238 60.9392C21.9851 63.1804 23.2657 65.2081 24.7599 67.0224L24.1195 67.556C21.9851 66.7022 19.8506 65.635 17.8228 64.3543ZM32.0171 59.6585C30.9498 58.0576 30.3095 56.1366 30.3095 54.1089C30.3095 53.1483 30.4162 52.2946 30.7364 51.4408C31.9104 47.2785 35.7524 44.2903 40.2348 44.2903C42.2625 44.2903 44.1836 44.9306 45.7844 45.9979L32.0171 59.6585Z" fill="#FFFFFF"/>
                <path d="M90.6083 9.39168L100 0H92.6361L86.6596 5.97652C88.1537 6.93703 89.4344 8.11099 90.6083 9.39168Z" fill="#FFFFFF"/>
              </g>
              <defs>
                <clipPath id="clip0_11_11">
                  <rect width="100" height="87" fill="white"/>
                </clipPath>
              </defs>
            </svg>
          </div>
        </button>
      </div>
    )
  }

  return (
    <>
      <div className="fixed bottom-8 right-8 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="h-16 w-16 rounded-full bg-blue-600 hover:bg-blue-700 shadow-2xl hover:shadow-blue-500/50 transition-all duration-300 hover:scale-110 flex items-center justify-center p-2"
          aria-label="Open accessibility settings"
          aria-expanded={isOpen}
        >
          <div className="relative w-full h-full flex items-center justify-center">
            <svg width="40" height="35" viewBox="0 0 100 87" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clipPath="url(#clip0_11_11)">
                <path d="M82.8175 33.191L76.9477 47.0651C78.0149 48.0256 78.9755 48.8794 79.7225 49.6265L86.1259 34.5784L86.4461 33.7247V33.6179C87.0865 31.6969 87.4066 29.7759 87.4066 27.7481C87.4066 18.2497 79.7225 10.5656 70.2241 10.5656C60.7257 10.5656 53.0416 18.2497 53.0416 27.7481V30.9498H54.8559H56.5635L56.6702 27.3212C56.8837 19.9573 62.9669 14.0875 70.3309 14.0875C77.8015 14.0875 83.9915 20.1708 83.9915 27.7481C83.9915 29.349 83.778 30.8431 83.2444 32.3372L82.8175 33.191Z" fill="#FFFFFF"/>
                <path d="M70.1174 2.2412C56.0299 2.2412 44.5037 13.7673 44.5037 27.8549H48.1323C48.1323 15.6884 58.0576 5.8698 70.1174 5.8698C82.1772 5.8698 92.1025 15.7951 92.1025 27.8549C92.1025 30.5229 91.6756 33.0843 90.7151 35.539L90.6083 35.8591L74.3863 73.6393L73.8527 74.7065C71.3981 78.9755 66.809 81.5368 61.8997 81.5368C57.4173 81.5368 53.3618 79.2956 50.8004 75.9872C49.6265 76.4141 48.4525 76.7343 47.1718 77.0544C50.2668 81.9637 55.7097 85.1654 61.8997 85.1654C68.0897 85.1654 73.8527 81.857 76.9477 76.5208L77.6948 75.1334L94.0235 37.2465L94.2369 36.8196C95.3042 33.9381 95.8378 30.9498 95.8378 27.8549C95.7311 13.7673 84.2049 2.2412 70.1174 2.2412Z" fill="#FFFFFF"/>
                <path d="M46.7449 73.6393C48.9861 73.2124 51.2273 72.6788 53.4685 71.9317L59.2316 66.1686L73.6393 51.7609C74.4931 52.508 75.2401 53.1483 75.7738 53.682L70.5443 58.9114L60.5123 68.9434C63.0736 67.6627 65.635 66.1686 68.0896 64.5678C71.5048 62.3266 74.1729 60.0854 76.0939 58.2711C76.4141 58.0576 76.6275 57.8442 76.841 57.6307C78.4418 56.1366 79.2956 55.1761 79.4024 55.0694L79.8292 54.5358L80.3629 54.0021L79.4024 52.9349C79.2956 52.8282 78.8687 52.2946 77.9082 51.4408C77.8015 51.334 77.8015 51.334 77.6948 51.2273C77.1612 50.6937 76.5208 50.1601 75.7738 49.413C75.3469 49.0928 74.92 48.666 74.3863 48.2391C73.9594 47.9189 73.5326 47.492 72.9989 47.1718C72.4653 46.7449 71.825 46.2113 71.1846 45.7844C71.0779 45.6777 70.9712 45.571 70.7577 45.4642C69.7972 44.8239 68.8367 44.0768 67.8762 43.4365C67.1291 42.9029 66.2754 42.3693 65.5283 41.9424C64.4611 41.302 63.3938 40.6617 62.3266 40.1281C61.5795 39.7012 60.7257 39.2743 59.9787 38.9541L75.0267 23.9061L71.0779 20.7044L54.8559 36.8196C49.8399 35.0053 44.9306 34.0448 40.1281 34.0448C35.1121 34.0448 29.9893 35.0053 24.7599 37.0331C20.5977 38.6339 16.4354 40.7684 12.3799 43.5432C5.4429 48.2391 1.17396 52.8282 0.960512 53.0416L0 54.1089L0.960512 55.1761C1.17396 55.3895 5.4429 59.9787 12.3799 64.6745C13.3404 65.3148 14.4077 65.9552 15.3682 66.5955C17.5027 67.8762 19.5304 68.9434 21.6649 69.9039L4.90929 86.873H12.2732L27.1078 72.0384L30.8431 68.3031L33.7247 65.4216L35.9658 63.1804L49.0929 50.0534L51.334 47.8122L54.2156 44.9306L56.4568 42.6894L57.6307 41.5155C58.3778 41.8356 59.2316 42.2625 59.9787 42.6894L57.7375 44.9306L55.3895 47.2785L33.0843 69.5838L29.7759 72.8922C31.1633 73.2124 32.5507 73.5325 33.9381 73.746L36.8196 70.8645L56.7769 50.9072L59.3383 48.3458L63.2871 44.397C64.0342 44.8239 64.8879 45.3575 65.635 45.8911L60.0854 51.4408L57.2038 54.3223L40.4482 71.0779L37.46 74.0662C37.8869 74.0662 38.4205 74.1729 38.8474 74.1729C39.2743 74.1729 39.8079 74.1729 40.2348 74.1729C40.9819 74.1729 41.7289 74.1729 42.3693 74.0662L46.6382 69.7972L55.8164 60.619L60.0854 56.3501L68.5165 47.9189C69.1569 48.3458 69.6905 48.7727 70.2241 49.1996C70.4376 49.3063 70.5443 49.413 70.651 49.6265L58.9114 61.4728L46.7449 73.6393ZM39.8079 37.1398C39.9146 37.1398 40.1281 37.1398 40.2348 37.1398C40.3415 37.1398 40.555 37.1398 40.6617 37.1398C44.5037 37.2465 48.0256 38.6339 50.8004 40.8751L47.9189 43.7567C45.7844 42.1558 43.0096 41.1953 40.1281 41.1953C32.9776 41.1953 27.1078 47.0651 27.1078 54.2156C27.1078 54.429 27.1078 54.7492 27.1078 54.9626C27.2145 57.6307 28.175 59.9787 29.6692 62.0064L26.7876 64.8879C25.2935 63.0736 24.2263 60.8324 23.5859 58.4845C23.2657 57.0971 23.0523 55.7097 23.0523 54.2156C23.2657 44.9306 30.6297 37.3533 39.8079 37.1398ZM17.8228 64.3543C16.6489 63.714 15.4749 62.9669 14.301 62.2199C9.60512 59.0181 6.08324 55.8164 4.37567 54.2156C5.97652 52.6147 9.4984 49.413 14.1942 46.2113C18.0363 43.5432 21.9851 41.5155 25.9338 40.0213C22.3052 43.6499 20.064 48.666 20.064 54.2156C20.064 56.5635 20.4909 58.8047 21.238 60.9392C21.9851 63.1804 23.2657 65.2081 24.7599 67.0224L24.1195 67.556C21.9851 66.7022 19.8506 65.635 17.8228 64.3543ZM32.0171 59.6585C30.9498 58.0576 30.3095 56.1366 30.3095 54.1089C30.3095 53.1483 30.4162 52.2946 30.7364 51.4408C31.9104 47.2785 35.7524 44.2903 40.2348 44.2903C42.2625 44.2903 44.1836 44.9306 45.7844 45.9979L32.0171 59.6585Z" fill="#FFFFFF"/>
                <path d="M90.6083 9.39168L100 0H92.6361L86.6596 5.97652C88.1537 6.93703 89.4344 8.11099 90.6083 9.39168Z" fill="#FFFFFF"/>
              </g>
              <defs>
                <clipPath id="clip0_11_11">
                  <rect width="100" height="87" fill="white"/>
                </clipPath>
              </defs>
            </svg>
          </div>
        </button>
      </div>

      {isOpen && (
        <div
          className="fixed bottom-28 right-8 z-50 w-80 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 rounded-lg shadow-2xl p-6"
          role="dialog"
          aria-label="Accessibility settings"
        >
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold">Accessibility</h2>
            <Button
              onClick={() => setIsOpen(false)}
              variant="ghost"
              size="sm"
              aria-label="Close accessibility settings"
            >
              <X className="h-5 w-5" />
            </Button>
          </div>

          <div className="space-y-6">
            <div>
              <div className="flex items-center justify-between mb-3">
                <Label htmlFor="font-size-slider" className="text-base font-semibold">
                  Text Size
                </Label>
                <span className="text-sm font-mono">{fontSize}px</span>
              </div>
              <div className="flex items-center gap-3">
                <Button
                  onClick={() => setFontSize(fontSize - 1)}
                  variant="outline"
                  size="sm"
                  disabled={fontSize <= 14}
                  aria-label="Decrease text size"
                >
                  <Minus className="h-4 w-4" />
                </Button>
                <Slider
                  id="font-size-slider"
                  min={14}
                  max={26}
                  step={1}
                  value={[fontSize]}
                  onValueChange={(value) => setFontSize(value[0])}
                  className="flex-1"
                  aria-label="Adjust text size"
                />
                <Button
                  onClick={() => setFontSize(fontSize + 1)}
                  variant="outline"
                  size="sm"
                  disabled={fontSize >= 26}
                  aria-label="Increase text size"
                >
                  <Plus className="h-4 w-4" />
                </Button>
              </div>
            </div>

            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Eye className="h-5 w-5" />
                <Label htmlFor="high-contrast" className="text-base font-semibold">
                  High Contrast
                </Label>
              </div>
              <Switch
                id="high-contrast"
                checked={highContrast}
                onCheckedChange={setHighContrast}
                aria-label="Toggle high contrast mode"
              />
            </div>

            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Volume2 className="h-5 w-5" />
                <Label htmlFor="tts-enabled" className="text-base font-semibold">
                  Read Aloud
                </Label>
              </div>
              <Switch
                id="tts-enabled"
                checked={ttsEnabled}
                onCheckedChange={setTtsEnabled}
                aria-label="Toggle text-to-speech"
              />
            </div>

            <div className="flex items-center justify-between">
              <Label htmlFor="reduced-motion" className="text-base font-semibold">
                Reduce Motion
              </Label>
              <Switch
                id="reduced-motion"
                checked={reducedMotion}
                onCheckedChange={setReducedMotion}
                aria-label="Toggle reduced motion"
              />
            </div>
          </div>

          <p className="text-xs text-gray-600 dark:text-gray-400 mt-6">
            Settings are saved automatically
          </p>
        </div>
      )}
    </>
  )
}
